<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- REPORT ACTION FOR BILL -->
        <record id="action_test_result_report_bill" model="ir.actions.report">
            <field name="name">Lab Bill</field>
            <field name="model">test.result</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">rawdah_laboratory_management.test_result_template_bill</field>
            <field name="report_file">rawdah_laboratory_management.test_result_template_bill</field>
            <field name="print_report_name">'Bill - %s' % (object.result_no)</field>
        </record>

        <!-- QWEB TEMPLATE FOR BILL -->
        <template id="test_result_template_bill">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-call="web.external_layout">
                        <div class="page">
                            <style>
                                /* Global Professional Font settings */
                                .page {
                                    font-family: 'Georgia', 'Times New Roman', Times, serif;
                                    font-size: 14px;
                                    color: #000;
                                }

                                /* Header Styling */
                                .bill-title {
                                    font-size: 24px;
                                    font-weight: bold;
                                    text-transform: uppercase;
                                    letter-spacing: 2px;
                                    text-align: center;
                                    margin-bottom: 5px;
                                    color: #333;
                                }
                                .bill-subtitle {
                                    text-align: center;
                                    font-size: 12px;
                                    margin-bottom: 20px;
                                    color: #666;
                                }

                                /* Section Headers */
                                .section-header {
                                    color: #000;
                                    font-weight: bold;
                                    text-transform: uppercase;
                                    padding: 5px 10px;
                                    font-size: 12px;
                                    border-bottom: 1px solid #ccc;
                                    margin-bottom: 8px;
                                }

                                /* Info Tables */
                                .info-table td { padding: 3px 0; }
                                .label-col { font-weight: bold; color: #444; width: 35%; }
                                .val-col { color: #000; }

                                /* Itemized Bill Table */
                                .bill-table thead th {
                                    background-color: #333;
                                    color: #fff;
                                    text-transform: uppercase;
                                    font-size: 12px;
                                    padding: 8px;
                                    border: none;
                                }
                                .bill-table tbody td {
                                    padding: 8px;
                                    border-bottom: 1px solid #eee;
                                    vertical-align: middle;
                                }
                                .bill-table-total {
                                    font-weight: bold;
                                    background-color: #f9f9f9;
                                }

                                /* Totals Box */
                                .totals-container {
                                    margin-top: 20px;
                                    page-break-inside: avoid;
                                }
                                .total-row td { padding: 5px 10px; }
                                .grand-total {
                                    font-size: 16px;
                                    font-weight: bold;
                                    border-top: 2px solid #000;
                                    border-bottom: 2px solid #000;
                                    background-color: #f0f0f0;
                                }
                            </style>

                            <!-- Main Title -->
                            <div class="bill-title">Laboratory Invoice</div>
                            <div class="bill-subtitle">Original Copy</div>
                            <hr style="border-top: 2px solid #333; margin-bottom: 25px;"/>

                            <!-- Two Column Info Section -->
                            <div class="row" style="margin-bottom: 45px;">
                                <!-- Patient Info -->
                                <div class="col-6">
                                    <table class="table-sm info-table" style="width:100%; border:none;">
                                        <tr>
                                            <td class="label-col">Lab No.</td>
                                            <td class="val-col">: <span t-esc="o.result_no"/></td>
                                        </tr>
                                        <tr>
                                            <td class="label-col">Patient Name</td>
                                            <td class="val-col">:
                                                <span t-esc="o.patient_id.name" t-if="o.patient_id"/>
                                                <span t-if="not o.patient_id">N/A</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="label-col">Age / Gender</td>
                                            <td class="val-col">:
                                                <span t-esc="o.age" t-if="o.age"/> /
                                                <span t-esc="o.gender" t-if="o.gender"/>
                                            </td>
                                        </tr>
                                    </table>
                                </div>

                                <!-- Invoice Info -->
                                <div class="col-6">
                                    <table class="table-sm info-table" style="width:100%; border:none;">
                                        <tr>
                                            <td class="label-col">Invoice Date</td>
                                            <td class="val-col">:
                                                <span t-esc="o.result_date" t-if="o.result_date" t-options='{"widget": "date"}'/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="label-col">Ref. By</td>
                                            <td class="val-col">: <span t-esc="o.referred_by or '-'"/></td>
                                        </tr>
                                        <tr>
                                            <td class="label-col">Customer. No</td>
                                            <td class="val-col">: <span t-esc="o.reference_no or '-'"/></td>
                                        </tr>
                                    </table>
                                </div>
                            </div>

                            <!-- Itemized Bill Table -->
                            <table class="table bill-table" style="width:100%; margin-bottom: 0;">
                                <thead>
                                    <tr>
                                        <th style="width:55%; text-align :left;">Test Name</th>
                                        <th style="width:15%; text-align:left;">Price</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr t-foreach="o.test_ids" t-as="test">
                                        <td>
                                            <span t-esc="test.name" style="font-weight:bold;"/>
                                        </td>
                                        <td class="text-right">
                                            <span t-esc="'{:,.2f}'.format(test.test_amount)"/>
                                        </td>
                                    </tr>
                                    <tr t-if="not o.test_ids">
                                        <td colspan="4" class="text-center" style="padding:20px; font-style:italic;">
                                            No tests selected.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <!-- Totals Section -->
                            <div class="row totals-container">
                                <div class="col-7">
                                    <!-- Notes Box -->
                                    <div style="border: 1px dashed #ccc; padding: 10px; background-color: #fdfdfd; font-size:12px;">
                                        <strong>Terms &amp; Conditions:</strong>
                                        <ul style="margin: 5px 0 0 15px; padding:0; color:#555;">
                                            <li>Payment is due upon receipt.</li>
                                            <li>Please keep this invoice for future reference.</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-5">
                                    <table style="width:100%; border-collapse: collapse;">
                                        <tr class="total-row">
                                            <td style="text-align:right;">Tax (0%):</td>
                                            <td style="text-align:right;">0.00</td>
                                        </tr>
                                        <tr class="total-row grand-total">
                                            <td style="text-align:right;">TOTAL AMOUNT:</td>
                                            <td style="text-align:right;">
                                                <span t-esc="'{:,.2f}'.format(sum(o.test_ids.mapped('test_amount')))"/>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>

                            <div style="text-align:center; margin-top:40px; font-size:11px; color:#888;">
                                <i>Thank you for choosing our laboratory services.</i>
                            </div>

                        </div>
                    </t>
                </t>
            </t>
        </template>

    </data>
</odoo>